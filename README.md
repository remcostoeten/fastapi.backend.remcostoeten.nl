# Remco Stoeten API

Simple, composable API for blog analytics and visitor tracking.

## Features

- **Health Check**: Basic and detailed health monitoring
- **Visitor Tracking**: Track unique visitors and sessions
- **Pageview Analytics**: Monitor page views and traffic patterns
- **Blog Analytics**: Track blog post views and engagement
- **Feedback System**: Collect user feedback and reactions

## Development Setup

1. **Install dependencies**:
   ```bash
   pip install -r requirements.txt
   ```

2. **Set up environment**:
   ```bash
   cp .env.example .env
   # Edit .env with your configuration
   ```

3. **Run the server**:
   ```bash
   python -m app.main
   ```

4. **Run tests**:
   ```bash
   pytest
   ```

## API Endpoints

### Health Check
- `GET /api/v1/health` - Basic health check
- `GET /api/v1/health/detailed` - Detailed health with feature status

### Documentation
- Visit `/docs` for interactive API documentation (development only)

## Environment Variables

See `.env.example` for all available configuration options.

## Deployment

### Automated Deployment (Recommended)

The project is set up with GitHub Actions for automated deployment to Railway:

1. **Set up Railway:**
   ```bash
   ./scripts/setup-railway.sh
   ```

2. **Add Railway Token to GitHub:**
   - Go to Railway account settings â†’ API Tokens
   - Create a new token
   - Add to GitHub repository secrets as `RAILWAY_TOKEN`

3. **Push to GitHub:**
   ```bash
   git add .
   git commit -m "feat: initial backend setup"
   git push origin feature/new-backend
   ```

4. **Automatic CI/CD:**
   - Tests run automatically
   - Docker image built and tested
   - Deployed to Railway on merge to main/master
   - Health check validates deployment

### Manual Deployment

#### Railway CLI
```bash
# Install Railway CLI
curl -fsSL https://railway.app/install.sh

# Login and deploy
railway login
./scripts/deploy.sh
```

#### Docker
```bash
docker build -t remcostoeten-api .
docker run -p 8000:8000 remcostoeten-api
```

## Environment Variables

### Required for Railway:
- `RAILWAY_TOKEN`: GitHub secret for automated deployment
- `DATABASE_URL`: Automatically provided by Railway PostgreSQL
- `SECRET_KEY`: Auto-generated by setup script

### Optional:
- `ENVIRONMENT`: development/production (auto-set by Railway)
- `ENABLE_ANALYTICS`: true/false
- `ENABLE_FEEDBACK`: true/false
- `INCREMENT_VIEWS_ONLY_IN_PRODUCTION`: true/false

## GitHub Actions

The project includes two workflows:

### CI/CD Pipeline (`.github/workflows/ci.yml`)
- Runs tests on all push/PR
- Deploys to Railway on main/master branch
- Includes Docker build testing
- Health check validation

### Preview Deploy (`.github/workflows/preview.yml`)
- Tests PRs with preview builds
- Comments on PR with build status
- Validates Docker functionality

### Required GitHub Secrets:
- `RAILWAY_TOKEN`: Railway API token for deployment

## Architecture

This API follows a composable architecture:
- Each feature is self-contained
- Functional programming style where possible
- Simple, predictable endpoints
- Environment-based feature toggles

## Testing

The project includes a comprehensive test suite:
```bash
pytest                    # Run all tests
pytest tests/test_health.py  # Run specific test file
pytest -v                 # Verbose output
```

## Next Features

1. Visitor tracking system
2. Pageview analytics
3. Blog view counting
4. Feedback system
5. Contact form handling